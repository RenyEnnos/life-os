name: Secrets Check
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Fail on exposed Supabase keys
        run: |
          set -e
          # Skip .env files
          grep -R --line-number --exclude-dir=.git --exclude=.env --exclude=.env.* -E '(SUPABASE_SERVICE_ROLE_KEY|SUPABASE_SERVICE_KEY|VITE_SUPABASE_ANON_KEY|VITE_SUPABASE_URL)\s*=\s*(https?:|sk-|eyJhbGci)' . && { echo "Found potential exposed credentials"; exit 1; } || echo "No exposed credentials detected"
